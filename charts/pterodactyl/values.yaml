# yaml-language-server: $schema=../app-template.schema.json
app-template:
  controllers:
    main:
      strategy: Recreate
      containers:
        pterodactyl:
          image:
            repository: ghcr.io/pterodactyl/panel
            tag: v1.11.10
          env:
            TZ: America/Vancouver
            CACHE_DRIVER: "redis"
            SESSION_DRIVER: "redis"
            QUEUE_DRIVER: "redis"
            APP_ENV: "production"
            APP_ENVIRONMENT_ONLY: "false"
            APP_TIMEZONE: America/Vancouver
            APP_URL: "https://pterodactyl.g4v.dev"
            TRUSTED_PROXIES: "*"
            REDIS_HOST: "{{.Release.Name}}-redis-master"
            REDIS_PORT: 6379
            REDIS_PASSWORD:
              valueFrom:
                secretKeyRef:
                  name: "{{ .Release.Name }}-redis"
                  key: redis-password
          envFrom:
            - secretRef:
                name: "{{.Release.Name}}-secret"
          probes:
            liveness: &probes
              enabled: true
            readiness: *probes
            startup:
              enabled: false
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: false # updates nginx, cron, supervisor, etc
            capabilities:
              drop: ["ALL"]
          resources:
            limits:
              memory: 2Gi
            requests:
              memory: 256Mi
              cpu: 10m
      pod:
        securityContext:
          runAsUser: 0
          runAsGroup: 0
          runAsNonRoot: false
          fsGroup: 0
          fsGroupChangePolicy: OnRootMismatch
  service:
    main:
      controller: main
      ports:
        http:
          port: 80
  ingress:
    main:
      enabled: true
      annotations:
        gethomepage.dev/enabled: "true"
      hosts:
        - host: pterodactyl.g4v.dev
          paths:
            - path: /
              service:
                identifier: main
                port: http
  persistence:
    config:
      enabled: true
      type: persistentVolumeClaim
      accessMode: ReadWriteOnce
      size: 1Gi
      storageClass: nas-apps
