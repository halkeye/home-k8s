state_dir /dev/shm/maddy/state
runtime_dir /dev/shm/maddy/run

openmetrics tcp://0.0.0.0:9749 { }

tls off

hostname {env:SMTP_DOMAIN}

smtp tcp://0.0.0.0:2525 {
    debug {env:DEBUG}
    io_debug {env:DEBUG}

    source gavinmogan.com {
        deliver_to &remote_gavinmogan_queue
    }

    source g4v.dev {
        deliver_to &remote_g4v_queue
    }

    source halkeye.net {
        deliver_to &remote_halkeye_queue
    }

    default_source {
        reject
    }
}

target.queue remote_gavinmogan_queue {
    debug {env:DEBUG}
    target &remote_gavinmogan_smtp
}

target.smtp remote_gavinmogan_smtp {
    debug {env:DEBUG}
    starttls yes
    auth plain k8s@gavinmogan.com {env:SMTP_GAVINMOGAN_PASSWORD}
    targets tcp://{env:SMTP_SERVER}:{env:SMTP_PORT}
}

target.queue remote_g4v_queue {
    debug {env:DEBUG}
    target &remote_g4v_smtp
}

target.smtp remote_g4v_smtp {
    debug {env:DEBUG}
    starttls yes
    auth plain k8s@g4v.com {env:SMTP_G4V_PASSWORD}
    targets tcp://{env:SMTP_SERVER}:{env:SMTP_PORT}
}

target.queue remote_halkeye_queue {
    debug {env:DEBUG}
    target &remote_halkeye_smtp
}

target.smtp remote_halkeye_smtp {
    debug {env:DEBUG}
    starttls yes
    auth plain k8s@halkeye.net {env:SMTP_HALKEYE_PASSWORD}
    targets tcp://{env:SMTP_SERVER}:{env:SMTP_PORT}
}
