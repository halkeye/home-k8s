controllers:
  proxy:
    strategy: RollingUpdate
    annotations:
      reloader.stakater.com/auto: "true"
    containers:
      main:
        image:
          repository: docker.io/serjs/go-socks5-proxy
          tag: latest@sha256:0860123875caf65a6e367c08b5829f08aa1c99bdcbf2a7a27b7aeb5580522239
        env:
          PROXY_PORT: 1080
          REQUIRE_AUTH: false
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop: ["ALL"]
        resources:
          requests:
            cpu: 10m
            memory: 512Mi
          limits:
            memory: 512Mi
        probes:
          liveness:
            enabled: false
          readiness:
            enabled: false
          startup:
            enabled: false
    pod:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: kubernetes.io/arch
                    operator: NotIn
                    values:
                      - arm64
service:
  socks5:
    controller: proxy
    externalTrafficPolicy: Local
    type: LoadBalancer
    loadBalancerIP: 172.16.10.208
    annotations:
      external-dns.alpha.kubernetes.io/target: 172.16.10.208
      external-dns.alpha.kubernetes.io/hostname: "proxy.g4v.dev"
    ports:
      socks5:
        port: 1080
        protocol: TCP
