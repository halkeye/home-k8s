# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s-labs/helm-charts/main/charts/library/common/values.schema.json
controllers:
  main:
    replicas: 1
    annotations:
      reloader.stakater.com/auto: "true"
    containers:
      trmnl:
        image:
          repository: ghcr.io/usetrmnl/terminus
          tag: 0.14.0
        env:
          API_URI: https://trmnl.g4v.dev
          HANAMI_PORT: 8080
          DATABASE_URL:
            valueFrom:
              secretKeyRef:
                name: "trmnl-db-secret-trmnl"
                key: POSTGRES_URL
          # PHP_OPCACHE_ENABLE: 1
          # TRMNL_PROXY_REFRESH_MINUTES: 15
          # FORCE_HTTPS: 1
          # DB_CONNECTION: pgsql
          # DB_HOST:
          #   valueFrom:
          #     secretKeyRef:
          #       name: "trmnl-db-secret-trmnl"
          #       key: HOST_NO_PORT
          # DB_PORT:
          #   valueFrom:
          #     secretKeyRef:
          #       name: "trmnl-db-secret-trmnl"
          #       key: PORT
          # DB_DATABASE:
          #   valueFrom:
          #     secretKeyRef:
          #       name: "trmnl-db-secret-trmnl"
          #       key: DATABASE_NAME
          # DB_USERNAME:
          #   valueFrom:
          #     secretKeyRef:
          #       name: "trmnl-db-secret-trmnl"
          #       key: ROLE
          # DB_PASSWORD:
          #   valueFrom:
          #     secretKeyRef:
          #       name: "trmnl-db-secret-trmnl"
          #       key: PASSWORD
        envFrom:
          - secretRef:
              name: "trmnl-secret"
        resources:
          limits:
            memory: 1Gi
          requests:
            memory: 1Gi
            cpu: 30m
service:
  main:
    controller: main
    ports:
      http:
        port: 8080
ingress:
  main:
    enabled: true
    hosts:
      - host: "trmnl.g4v.dev"
        paths:
          - path: /
            service:
              identifier: main
              port: http
persistence:
  tmp:
    enabled: true
    type: emptyDir
  storage:
    enabled: true
    type: emptyDir
    globalMounts:
      - path: /var/www/html/storage/app/public/images/generated
