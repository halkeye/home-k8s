app-template:
  controllers:
    main:
      containers:
        main:
          image:
            repository: firezone/firezone
            tag: 0.7.36
          env:
            TZ: America/Vancouver
            VERSION: latest
            EXTERNAL_URL: https://vpn.g4v.dev
            DEFAULT_ADMIN_EMAIL: vpn@g4v.dev
            DATABASE_PORT: "5432"
            DATABASE_HOST:
              valueFrom:
                secretKeyRef:
                  name: firezone-db-secret-firezone
                  key: HOST
            DATABASE_NAME: "firezone"
            DATABASE_USER:
              valueFrom:
                secretKeyRef:
                  name: firezone-db-secret-firezone
                  key: LOGIN
            DATABASE_PASSWORD:
              valueFrom:
                secretKeyRef:
                  name: firezone-db-secret-firezone
                  key: PASSWORD

            # The ability to change the IPv4 and IPv6 address pool will be removed
            # in a future Firezone release in order to reduce the possible combinations
            # of network configurations we need to handle.
            #
            # Due to the above, we recommend not changing these unless absolutely
            # necessary.
            WIREGUARD_IPV4_NETWORK: 100.64.0.0/10
            WIREGUARD_IPV4_ADDRESS: 100.64.0.1
            WIREGUARD_IPV6_NETWORK: fd00::/106
            WIREGUARD_IPV6_ADDRESS: fd00::1
          envFrom:
            - secretRef:
                name: "{{.Release.Name}}-secret"
          securityContext:
            allowPrivilegeEscalation: true
            readOnlyRootFilesystem: true
            capabilities:
              drop: ["ALL"]
              add:
                - NET_ADMIN           # perform various network-related operations
                - SYS_MODULE          # load and unload kernel modules
          resources:
            limits: &resources
              memory: 1Gi
            requests:
              <<: *resources
              cpu: 10m
      pod:
        securityContext:
          runAsUser: 0
          runAsGroup: 0
          runAsNonRoot: false
          fsGroup: 0
          fsGroupChangePolicy: OnRootMismatch

  service:
    main:
      ports:
        http:
          port: 13000
    wireguard:
      enabled: true
      controller: main
      type:  LoadBalancer
      ports:
        wireguard:
          enabled: true
          protocol: UDP
          port:  51820

  ingress:
    main:
      enabled: true
      annotations:
        hajimari.io/icon: https://raw.githubusercontent.com/walkxcode/dashboard-icons/master/png/wireguard.png
        gethomepage.dev/enabled: "true"
        gethomepage.dev/group: VPN
        gethomepage.dev/icon: https://raw.githubusercontent.com/walkxcode/dashboard-icons/master/png/wireguard.png
        gethomepage.dev/name: Firezone
      hosts:
        - host: &host "vpn.g4v.dev"
          paths:
            - path: /
              service:
                name: main
                port: http

  persistence:
    data:
      enabled: true
      type: persistentVolumeClaim
      storageClass: synology-iscsi
      accessMode: ReadWriteOnce
      size: 1Gi
      globalMounts:
        - path: /var/firezone
